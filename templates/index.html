{% extends "base.html" %} {% block title %}LegisTech - Início{% endblock %} {%
block content %}
<h1>LegisTech - Gerador de Pareceres</h1>

<a
  href="{{ url_for('gerenciar') }}"
  style="font-size: 1.1em; margin-bottom: 20px; display: inline-block"
>
  Gerenciar Membros e Comissões
</a>

<h2>1ª Etapa: Envio do Documento</h2>
<p>Selecione o arquivo PDF do Projeto de Lei para iniciar.</p>

<form action="/upload" method="post" enctype="multipart/form-data">
  <label for="file">Arquivo PDF:</label>
  <input type="file" name="file" id="file" required />
  <input type="submit" value="Enviar e Extrair Dados" />
</form>

<div
  style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2em;
  "
>
  <h2>Histórico de Documentos Gerados</h2>

  <form
    action="{{ url_for('limpar_historico') }}"
    method="POST"
    onsubmit="return confirm('Tem certeza que deseja apagar TODO o histórico? Esta ação é irreversível.');"
  >
    <input
      type="submit"
      value="Limpar Histórico"
      style="
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 8px;
        cursor: pointer;
        border-radius: 4px;
      "
    />
  </form>
</div>

<table
  class="history-table"
  style="width: 100%; border-collapse: collapse; margin-top: 1em"
>
  <thead>
    <tr style="text-align: left">
      <th style="border: 1px solid #ddd; padding: 8px">PDF Original</th>
      <th style="border: 1px solid #ddd; padding: 8px">Nº do Projeto</th>
      <th style="border: 1px solid #ddd; padding: 8px">Data de Geração</th>
      <th style="border: 1px solid #ddd; padding: 8px">Download do Parecer</th>
      <th style="border: 1px solid #ddd; padding: 8px">Ações</th>
    </tr>
  </thead>
  <tbody>
    {% for item in historico %}
    <tr>
      <td style="border: 1px solid #ddd; padding: 8px">{{ item.pdf_name }}</td>
      <td style="border: 1px solid #ddd; padding: 8px">
        {{ item.numero_projeto }}
      </td>
      <td style="border: 1px solid #ddd; padding: 8px">
        {{ item.data_geracao }}
      </td>
      <td style="border: 1px solid #ddd; padding: 8px">
        <a href="{{ url_for('download', filename=item.docx_name) }}">
          {{ item.docx_name }}
        </a>
      </td>

      <td style="border: 1px solid #ddd; padding: 8px; text-align: center">
        <form
          action="{{ url_for('deletar_historico', item_id=item.id) }}"
          method="POST"
          onsubmit="return confirm('Deletar este item?');"
          style="margin: 0"
        >
          <input type="hidden" name="item_id" value="{{ item.id }}" />
          <input
            type="submit"
            value="Deletar"
            style="
              background-color: #dc3545;
              color: white;
              border: none;
              padding: 5px 8px;
              cursor: pointer;
              border-radius: 4px;
            "
          />
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
